/*
 * f0xy.JS v1.0
 * http://f0xy.org
 *
 * (c) 2011, Taka Kojima
 * Licensed under the MIT License
 *
 * Date: Sun Nov 27 04:32:14 2011 -0800
 */
 var f0xy=function(a){"use strict",Array.prototype.indexOf=Array.prototype.indexOf||function(a,b){for(var c=this.length,b=b<0?b+c<0?0:b+c:b||0;b<c&&this[b]!==a;b++);return c>b?b:-1},Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=Array.prototype.slice.call(arguments),c=b.shift();return function(){var d=b.concat(Array.prototype.slice.call(arguments));return this!==e&&d.push(this),a.apply(c,d)}};var b=[],c=".",d="",e=a,f={},g=!1,h=[],i=[],j=null,k=[],l=[],m=null,n=Array.isArray||function(a){return toString.call(a)=="[object Array]"},o=function(a){return Object(a)===a},p=function(a){return typeof a=="string"},q=function(a){return toString.call(a)=="[object Function]"},r=function(a){return p(a)?[a]:a},s=function(a,b){return b=b||[],(a?a:[]).concat(b)},t=setTimeout,u=function(a){a=A.get(a,!1);if(!a.isClass)return!1;if(a.dependencies)for(var b=0;b<a.dependencies.length;b++)if(!u(a.dependencies[b]))return!1;return!0},v=function(){var a=i;for(var b=a.length-1;b>=0;b--){var d=a[b].split(c),e=d.splice(d.length-1,1)[0];d=A.get(d.join(c),!1);if(d[e].toExtend){var f=A.get(d[e].extendedFrom,!1);if(f.isClass){d[e].toExtend=!1,delete d[e].toExtend,d[e]=A.extend(f,d[e]),a.splice(b,1),t(v,0);return}}}w()},w=function(){for(var a=h.length-1;a>=0;a--){var b=h[a],c=!0;for(var d=0;d<b.c.length;d++){c=u(b.c[d]);if(!c)break}c&&(b.cb&&b.cb(),h.splice(a,1))}},x=function(){var a=k;j&&clearTimeout(j);for(var b=0;b<a.length;b++){var c=a[b];c.e+=50,A.isClass(c.c)?c.s.onload():c.e>=A.errorTimeout&&c.s.onerror()}a.length>0&&(j=t(x,50))},y=function(a){function d(a,e){if(l.indexOf(a)<0){if(!b[c])return t(d,0,a,e);var f=b.createElement("script");f.async=!0,f.src=a;var g={f:a,c:e,e:0,s:f};l.push(a),k.push(g),f.onreadystatechange=f.onload=function(a){A.isClass(e)&&(g.s.onload=f.onreadystatechange=null,k.splice(k.indexOf(g),1))},f.onerror=function(a){throw k.splice(k.indexOf(g),1),new Error(g.c+" failed to load. Attempted to load from file: "+g.f)},b[c].appendChild(f)}}var b=document,c="body";h.push(a);for(var e=0;e<a.f.length;e++)d(a.f[e],a.c[e]);j=t(x,50)},z=function(a,b,d){a=a||"",d=d||!1;var e=A.ns;if(a!=""&&!o(a)&&!q(a)){var f=a.split(c);f[0]==="f0xy"&&(e=A,f.splice(0,1));for(var g=0;g<f.length;g++){if(!e[f[g]])if(b)e[f[g]]={};else return!1;e=e[f[g]]}}else a!=""&&(e=a);if(d){d.require=s(d.require);var h=d.require;for(var j in d)if(j!=="require"){var k=a+c+j,l=d[j];l.extendedFrom&&h.push(l.extendedFrom),l.toExtend&&i.indexOf(k)<0&&i.push(k),l.nsID=a,l.ns=e,l.className=j,h.length>0&&(l.dependencies=s(l.dependencies,h),A.require(h));if(A.isClass(l)&&l.prototype){var m=l.prototype;m.nsID=a,m.ns=e,m.className=j,h.length>0&&(m.dependencies=s(m.dependencies,h))}e[j]=l}}return e},A={};return A.ns={},A.errorTimeout=1e4,A.configure=function(a,b,f){d=a||d,c=b||c,d=d.lastIndexOf("/")===d.length-1?d:d+"/";if(!g){if(f!==!1){for(var h in A.ns)e[h]||(e[h]=A.ns[h]);A.ns=e}g=!0}},A.get=function(a){return z(a,!1)},A.define=function(a,b){var c=z(a,!0,b);return v(),c},A.getURL=function(a){return b[a]?b[a]:d+a.replace(new RegExp("\\"+c,"g"),"/")+".js"},A.isClass=function(a){return a=!o(a)&&!q(a)?z(a,!1):a,a?a.isClass:!1},A.extend=function(a,b){return A.isClass(a)?b=A.get(a).extend(b):b.toExtend=!0,b.extendedFrom=a,b},A.use=function(a){a=r(a);for(var b=0;b<a.length;b++){var d=a[b],e=A.get(d,!0),g=d.split(c),d=g.splice(g.length-1,1)[0];g=A.get(g.join(c),!1);if(d==="*")for(var h in g)f[h]=A.ns[h]?A.ns[h]:null,A.ns[h]=g[h];else g[d]&&(f[d]=A.ns[d]?A.ns[d]:null,A.ns[d]=g[d])}},A.unuse=function(){for(var a in f)A.ns[a]=f[a],A.ns[a]===null&&delete A.ns[a];f={}},A.provides=function(a,c,e,f){c=r(c),a=(new RegExp("(http://|/)[^ :]+")).test(a)?a:d+a;for(var g=0;g<c.length;g++)b[c[g]]=a;e&&A.require(c,f)},A.require=function(a,b){g||f0xy.configure(),a=r(a);var c=[],d=[];for(var e=0;e<a.length;e++){var f=a[e],h=A.getURL(f);l.indexOf(h)<0&&!A.get(f)&&(c.push(h),d.push(f))}if(c.length>0){var i={f:c,c:d,cb:b};y(i)}else b&&b()},A.enableNotifications=function(){A.isClass("f0xy.NotificationManager")&&(m=new A.NotificationManager)},A.addInterest=function(){m&&m.addInterest.apply(m,arguments)},A.addInterests=function(){m&&m.addInterests.apply(m,arguments)},A.removeInterest=function(){m&&m.removeInterest.apply(m,arguments)},A.removeInterests=function(){m&&m.removeInterests.apply(m,arguments)},A.removeAllInterests=function(){m&&m.removeAllInterests.apply(m,arguments)},A.notify=function(){m&&m.notify.apply(m,arguments)},A.holdNotification=function(){m&&m.holdNotification.apply(m,arguments)},A.releaseNotification=function(){m&&m.releaseNotification.apply(m,arguments)},A.cancelNotification=function(){m&&m.cancelNotification.apply(m,arguments)},A}(this);f0xy.define("f0xy",{$$__BaseClass__$$:function(a){var b=function(){};return b.isClass=!0,b.extend=function c(b){a=!1;var d=new this;a=!0;var e=this;d.dependencies&&(b.dependencies=b.dependencies||[],b.dependencies=b.dependencies.concat(d.dependencies));for(name in b)d[name]=typeof b[name]=="function"&&typeof e.prototype[name]=="function"?function(a,b){return function(){this._super=e.prototype[a];var c=b.apply(this,arguments);return this._super=null,delete this._super,setTimeout(f0xy.unuse,0),c}}(name,b[name]):b[name];var f=function(){a&&this.init&&this.init.apply(this,arguments)};return f.prototype=d,f.constructor=f,f.extend=c,f.isClass=!0,b.ns&&(f.ns=b.ns),b.nsID&&(f.nsID=b.nsID),b.className&&(f.className=b.className),b.dependencies&&(f.dependencies=b.dependencies),f},b}()}),f0xy.define("f0xy",{Class:f0xy.extend("f0xy.$$__BaseClass__$$",{isClass:!0,_interestHandlers:[],init:function(){},use_dependencies:function(){this.dependencies&&f0xy.use(this.dependencies)},setTimeout:function(a,b){return window.setTimeout(this.proxy(a),b)},setInterval:function(a,b){return window.setInterval(this.proxy(a),b)},proxy:function(a){return a.bind(this)},addInterest:function(a,b,c){b&&(f0xy.addInterest(this,a,c),this._interestHandlers[a]=b)},removeInterest:function(a){this._interestHandlers[a]&&(this._interestHandlers[a]=null,delete this._interestHandlers[a]),f0xy.removeInterest(this,a)},removeInterests:function(a){for(var b=0;b<a.length;b++)this.removeInterest(a[b])},removeAllInterests:function(){f0xy.removeAllInterests(this),this._interestHandlers=[]},notify:function(a,b){var c=new f0xy.Notification(a,b);c.dispatch(this)},holdNotification:function(a){f0xy.holdNotification(a)},releaseNotification:function(a){f0xy.releaseNotification(a)},cancelNotification:function(a){f0xy.cancelNotification(a)},handleNotification:function(a){var b=this._interestHandlers[a.name];b&&this.proxy(b)(a)}})}),f0xy.define("f0xy",{NotificationManager:f0xy.extend("f0xy.Class",{_pendingNotifications:[],_interests:{},init:function(){},addInterest:function(a,b,c){typeof this._interests[b]=="undefined"&&(this._interests[b]=[]),c<=-1||typeof this._interests[b]!==undefined&&c>=this._interests[b].length?this._interests[b].push(a):this._interests[b].splice(c,0,a)},addInterests:function(a,b){for(var c=0;c<b.length;c++)if(typeof b[c]=="string")this.addInterest(a,b[c]);else if(typeof b[c]=="object"||typeof b[c]=="array"){var d=b[c]["priority"]!=null&&b[c]["priority"]!=undefined?b[c].priority:0;this.addInterest(a,b[c].name,d)}},removeInterest:function(a,b){var c=this._interests[b].indexOf(a);c>-1&&(this._interests[b].splice(c,1),this._notificationStatuses[b]==="pending"&&c>=this._notificationPointers[b]&&this._notificationPointers[b]--)},removeInterests:function(a,b){for(var c=0;c<b.length;c++)this.removeInterest(a,b[c])},removeAllInterests:function(a,b){if(a!=null)for(var c in this._interests)this.removeInterest(a,c);else b!=null&&(this._interests[b]=null)},notify:function(a){a.status="pending",this._interests[a.name]!=null&&(this._pendingNotifications.push(a),this._notifyObjects(a))},_notifyObjects:function(a){var b=a.name;while(a.pointer<this._interests[b].length)if(a.status==="pending")this._interests[b][a.pointer].handleNotification!=null&&this._interests[b][a.pointer].handleNotification(a),a.pointer++;else break;a.status==="pending"&&this.cancelNotification(a.name)},getNotification:function(a,b){for(var c=0;c<this._pendingNotifications.length;c++)if(this._pendingNotifications[c].name===a)return this._pendingNotifications[c];return b?new f0xy.Notification(a,b):!1},holdNotification:function(a){var b=this.getNotification(a);b&&(b.status="hold")},releaseNotification:function(a){var b=this.getNotification(a);b&&b.status==="hold"&&(b.status="pending",this._notifyObjects(b))},cancelNotification:function(a){var b=this.getNotification(a);b&&(this._pendingNotifications.splice(this._pendingNotifications.indexOf(b),1),b.status="")}})}),f0xy.define("f0xy",{Notification:f0xy.extend("f0xy.Class",{data:{},name:"",dispatcher:null,status:"",pointer:0,init:function(a,b){this.name=a,this.data=b},hold:function(){f0xy.holdNotification(this.name)},release:function(){f0xy.releaseNotification(this.name)},cancel:function(){f0xy.cancelNotification(this.name)},dispatch:function(a){this.dispatcher=a,f0xy.notify(this)}})}),f0xy.enableNotifications();
