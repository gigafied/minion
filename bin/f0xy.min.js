/*
 * f0xy.JS v1.0
 * http://f0xy.org
 *
 * (c) 2011, Taka Kojima
 * Licensed under the MIT License
 *
 * Date: Mon Nov 21 17:36:06 2011 -0800
 */
 var f0xy=function(a){"use strict",Array.prototype.indexOf=Array.prototype.indexOf||function(a){if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(c===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d<c){var e=d<0?Math.max(c-Math.abs(d),0):d;for(;e<c;e++)if(e in b&&b[e]===a)return e;return-1}return-1},Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=Array.prototype.slice.call(arguments),c=b.shift();return function(){var d=b.concat(Array.prototype.slice.call(arguments));return this!==e&&d.push(this),a.apply(c,d)}};var b=[],c=".",d="",e=a,f={},g=!1,h=[],i=[],j=null,k=[],l=[],m=[],n="string",o="function",p="object",q="number",r="undefined",s=function(a,b,c,d){return d=typeof a===b,d=!d&&c?typeof a===c:d,d},t=function(){var a=!1;for(var b=i.length-1;b>=0;b--){var d=i[b].split(c),e=d.splice(d.length-1,1),f=d.join(c),g=x.get(f,!1),h=g[e];if(h.toExtend){var j=x.get(h.extendedFrom,!1);if(j.isClass){var k=h.dependencies,l=h.extendedFrom;h.toExtend=!1,delete h.toExtend,g[e]=j.extend(h),a=!0,i.splice(b,1)}}}a&&i.length>0&&t()},u=function(){for(var a=h.length-1;a>=0;a--){var b=h[a],c=!0;for(var d=0;d<h[a].classes.length;d++){var e=x.get(h[a].classes[d],!1);if(!e.isClass)c=!1;else if(e.dependencies)for(var f=0;f<e.dependencies.length;f++)if(m.indexOf(e.dependencies[f])===-1){c=!1;break}if(!c)break}c&&(b.callback&&setTimeout(b.callback,0),h.splice(a,1))}},v=function(){j&&clearTimeout(j);for(var a=0;a<k.length;a++){var b=k[a];b.elapsed+=50,x.isClass(b.class)?b.script.onload():b.elapsed>=x.errorTimeout&&b.script.onerror()}k.length>0&&(j=setTimeout(v,50))},w=function(a,b,c){function g(b,i){if(l.indexOf(b)===-1){if(!e[f])return setTimeout(g,0,b,i);var j={};j.file=b,j.class=i,j.elapsed=0,l.push(b),k.push(j);var n=e.createElement("script");n.async="async",n.src=b,j.script=n,n.onreadystatechange=n.onload=function(b){x.isClass(i)&&(m.push(j.class),d++,d>=a.length&&c&&(t(),u(),setTimeout(c,50)),j.script.onload=n.onreadystatechange=null,k.splice(k.indexOf(j),1))},n.onerror=function(a){throw d++,k.splice(h,1),new Error(j.class+" failed to load. Attempted to load from file: "+j.file)},e[f].appendChild(n)}}var d=0,e=document,f="body";!s(a,p)&&!a.sort&&(a=Array(a));for(var h=0;h<a.length;h++)g(a[h],b[h]);j=setTimeout(v,50)},x={};return x.ns={},x.errorTimeout=1e4,x.configure=function(a,b,f){d=a||d,c=b||c,d=d.lastIndexOf("/")===d.length-1?d:d+"/";if(!g){if(f!==!1){for(var h in x.ns)e[h]||(console.log(x.ns,h),e[h]=x.ns[h]);x.ns=e}g=!0}},x.namespace=function(a,b,d){d=d||!1;var e=x.ns;if(a!=""&&!s(a,p,o)){var f=a.split(c);f[0]==="f0xy"&&(e=this,f.splice(0,1));for(var g=0;g<f.length;g++){if(!e[f[g]])if(b)e[f[g]]={};else return!1;e=e[f[g]]}}else s(a,p)&&(e=a);if(d!==!1){d.require||(d.require=[]);for(var h in d){var j=a+c+h;d[h].extendedFrom&&d.require.push(d[h].extendedFrom),d[h].toExtend&&i.indexOf(j)===-1&&i.push(j);if(h!=="require"){var k=d[h];k.nsID=a,k.ns=e,k.className=h,"require"in d&&d.require.length>0&&(k.dependencies=(k.dependencies?k.dependencies:[]).concat(d.require),x.require(d.require)),x.isClass(k)&&k.prototype&&(k.prototype.nsID=a,k.prototype.ns=e,k.prototype.className=h,"require"in d&&d.require.length>0&&(k.prototype.dependencies=(k.prototype.dependencies?k.prototype.dependencies:[]).concat(d.require))),e[h]=k}}}return e},x.get=function(a){return x.namespace(a,!1)},x.define=function(a,b){var c=x.namespace(a,!0,b);return t(),u(),c},x.getURL=function(a){if(b[a])return b[a];var e=new RegExp("\\"+c,"g");return d+a.replace(e,"/")+".js"},x.isClass=function(a){return a=s(a,p,o)?a:x.namespace(a,!1),a?a.isClass:!1},x.extend=function(a,b){return x.isClass(a)?b=x.get(a).extend(b):b.toExtend=!0,b.extendedFrom=a,b},x.use=function(a){f0xy.unuse(a),!s(a,p)&&!a.sort&&(a=Array(a));for(var b=0;b<a.length;b++){var d=a[b],e=d.split(c),g=e.pop(),h=x.get(e.join(c),!1);if(g==="*")for(var i in h)f[i]=x.ns[i]?x.ns[i]:null,x.ns[i]=h[i];else h[g]&&(f[g]=x.ns[g]?x.ns[g]:null,x.ns[g]=h[g])}},x.unuse=function(){for(var a in f)x.ns[a]=f[a],x.ns[a]===null&&delete x.ns[a]},x.provides=function(a,c,e,f){!s(c,p)&&!c.sort&&(c=Array(c)),a=(new RegExp("(http://|/)[^ :]+")).test(a)?a:d+a;for(var g=0;g<c.length;g++)b[c[g]]=a;e&&x.require(c,f)},x.require=function(a,b){g||f0xy.configure(),s(a,n)&&(a=[a]);var c=[],d=[];for(var e=0;e<a.length;e++){var f=a[e],i=x.getURL(f);l.indexOf(i)===-1&&!x.get(f)&&(c.push(x.getURL(f)),d.push(f))}if(c.length>0){var j={classes:d,files:c,callback:b};h.push(j),w(c,d,function(){t(),u()})}else{for(var e=0;e<a.length;e++){var f=a[e];x.get(f)&&m.indexOf(f)===-1&&m.push(f)}b&&b.call()}},x}(this);f0xy.define("f0xy",{$$__BaseClass__$$:function(a){var b=function(){};return b.isClass=!0,b.extend=function c(b){a=!1;var d=new this;a=!0;var e=this;d.dependencies&&(b.dependencies=b.dependencies||[],b.dependencies=b.dependencies.concat(d.dependencies));for(name in b)d[name]=typeof b[name]=="function"&&typeof e.prototype[name]=="function"?function(a,b){return function(){this._super=e.prototype[a];var c=b.apply(this,arguments);this._super=null,delete this._super,f0xy.unuse()}}(name,b[name]):b[name];var f=function(){a&&this.init&&this.init.apply(this,arguments)};return f.prototype=d,f.constructor=f,f.extend=c,f.isClass=!0,b.ns&&(f.ns=b.ns),b.nsID&&(f.nsID=b.nsID),b.className&&(f.className=b.className),b.dependencies&&(f.dependencies=b.dependencies),f},b}()}),f0xy.define("f0xy",{Class:f0xy.extend("f0xy.$$__BaseClass__$$",{isClass:!0,init:function(){},use_dependencies:function(){this.dependencies&&f0xy.use(this.dependencies)},setTimeout:function(a,b){return window.setTimeout(this.proxy(a),b)},setInterval:function(a,b){return window.setInterval(this.proxy(a),b)},proxy:function(a){return a.bind(this)}})});
