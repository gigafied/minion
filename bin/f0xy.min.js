/*
 * f0xy.JS v1.3
 * http://f0xy.org
 *
 * (c) 2011, Taka Kojima
 * Licensed under the MIT License
 *
 * Date: Thu Dec 8 00:01:02 2011 -0800
 */
 var f0xy=function(a){"use strict",Array.prototype.indexOf=Array.prototype.indexOf||function(a,b){if(!!this.length&&this instanceof Array&&arguments.length>=1){b=b||0;if(b<this.length){while(b<this.length){if(this[b]===a)return b;b+=1}return-1}return-1}return-1};var b=[],c=".",d="",e="",f={},g={},h,i=[],j=[],k,l=[],m=[],n,o=500,p;p=a.parent&&a.parent.f0xy?a.parent.f0xy:p,p=a.opener&&a.opener.f0xy?a.opener.f0xy:p;if(p)try{return p.copyToNS(a),p}catch(q){}var r=Array._isArray||function(a){return a instanceof Array},s=function(a){return typeof a=="object"},t=function(a){return typeof a=="string"||a instanceof String},u=function(a){return typeof a=="function"},v=function(a){return r(a)?a:[a]},w=function(a,b,c){b=b||[];if(!c)return a||[].concat(b);b=[].concat(b),a=a||[];for(var d=0,e=a.length;d<e;d+=1)b.indexOf(a[d])<0&&(b[b.length]=a[d]);return b},x=setTimeout,y=function(a){a=E.get(a,!1);var b;if(!a.__isDefined)return!1;if(a.__dependencies)for(b=0;b<a.__dependencies.length;b+=1)if(!y(a.__dependencies[b]))return!1;return!0},z=function(){var a,b,c,d;c={};for(a=i.length-1;a>=0;a--){c=i[a],d=!0;for(b=0;b<c.c.length;b++){d=y(c.c[b]);if(!d)break}d&&(c.cb&&c.cb(),i.splice(a,1))}},A=function(){var a=j,b,d,e,f;for(b=a.length-1;b>=0;b--){e=a[b].split(c),f=e.splice(e.length-1,1)[0],e=E.get(e.join(c),!1);if(e[f].__toExtend){d=E.get(e[f].__extendedFrom,!1);if(d.__isDefined){e[f].__toExtend=!1,delete e[f].__toExtend,e[f]=E.extend(e[f].__extendedFrom,e[f]),a.splice(b,1),x(A,0);return}}}z()},B=function(){var a=l,b,c;k&&clearTimeout(k);for(b=0;b<a.length;b+=1)c=a[b],c.e+=50,E.isDefined(c.c)||c.e>=E.errorTimeout&&c.s.onerror();a.length>0&&(k=x(B,o))},C=function(a){function d(a,e){var f,g;if(m.indexOf(a)<0){if(!b[c])return x(d,0,a,e);g=b.createElement("script"),g.async=!0,f={f:a,c:e,e:0,s:g},m.push(a),l.push(f),g.onreadystatechange=g.onload=function(a){E.isDefined(e)&&(f.s.onload=f.s.onreadystatechange=null,f.s.onerror=null,l.splice(l.indexOf(f),1))},g.onerror=function(a){throw new Error(f.c+" failed to load. Attempted to load from file: "+f.f)},g.src=a,b[c].appendChild(g)}}var b=document,c="head";i.push(a);for(var e=0;e<a.f.length;e+=1)d(a.f[e],a.c[e]);k=x(B,o)},D=function(a,b,d){a=a||"",d=d||!1;var e=E.ns,g=f,h;if(a&&!s(a)&&!u(a)){var i=a.split(c);i[0]==="f0xy"&&(e=E,g=g.f0xy||{},g.f0xy=g,i.splice(0,1));for(h=0;h<i.length;h+=1){if(!e[i[h]])if(b)e[i[h]]={},g[i[h]]={};else return!1;e=e[i[h]]}}else if(a!="")e=a;else return!1;if(d){d.require=w(d.require);var k=d.require;for(var l in d)if(l!=="require"){var m=a+c+l,n=d[l];n.__extendedFrom&&k.push(n.__extendedFrom),n.__toExtend&&j.indexOf(m)<0&&j.push(m),n.__nsID=a,n.__ns=e,n.__class=l,k.length>0&&(n.__dependencies=w(n.__dependencies,k,!0),E.require(k));if(E.isDefined(n)&&n.prototype){var o=n.prototype;o.__nsID=a,o.__ns=e,o.__class=l,k.length>0&&(o.__dependencies=w(o.__dependencies,k,!0))}e[l]=n,g[l]=n}}return e},E={};return E.ns={},E.errorTimeout=1e4,E.configure=function(b){b=b||{},d=b.rootPath||d,d=d.lastIndexOf("/")===d.length-1?d:d+"/",c=b.separator||c,e=b.fileSuffix||e;var f=!0;b.noPollution&&(f=!!b.noPollution);var g;if(!h){if(f!==!1){for(g in E.ns)a[g]||(a[g]=E.ns[g]);E.ns=a}h=!0}},E.get=function(a){return D(a,!1)},E.define=function(a,b){var c=D(a,!0,b);return A(),c},E.getURL=function(a){if(b[a])return b[a];var f=(d+a).replace(new RegExp("\\"+c,"g"),"/")+".js"+(e?"?"+e:"");return f},E.isDefined=function(a){return a=!s(a)&&!u(a)?D(a,!1):a,a?a.__isDefined:!1},E.extend=function(a,b){return E.isDefined(a)?b=E.get(a).__extend(b):b.__toExtend=!0,b.__extendedFrom=a,b},E.use=function(a,b){a=a||[],a=v(a),b=b||E.ns,b===E.ns&&E.unuse();var d,e,f,h,i;for(d=0;d<a.length;d+=1){e=a[d],f=E.get(e,!0),h=e.split(c),e=h.splice(h.length-1,1)[0],h=E.get(h.join(c),!1);if(e==="*")for(var i in h)b===E.ns&&(g[i]=b[i]?b[i]:null),b[i]=h[i];else h[e]&&(b===E.ns&&(g[e]=b[e]?b[e]:null),b[e]=h[e])}return b},E.unuse=function(){for(var a in g)E.ns[a]=g[a],E.ns[a]===null&&delete E.ns[a];g={}},E.copyToNS=function(a){a.f0xy=f0xy;for(var b in f)a[b]=E.ns[b]},E.provides=function(a,c,e,f){c=v(c),a=(new RegExp("(http://|/)[^ :]+")).test(a)?a:d+a;for(var g=0;g<c.length;g+=1)b[c[g]]=a;e&&E.require(c,f)},E.require=function(a,b){h||E.configure(),a=v(a);var c=[],d=[];for(var e=0;e<a.length;e+=1){var f=a[e],g=E.getURL(f);m.indexOf(g)<0&&!E.get(f)&&(c.push(g),d.push(f))}if(c.length>0){var i={f:c,c:d,cb:b};x(function(){C(i)},0)}else b&&b()},E.enableNotifications=function(){E.isDefined("f0xy.NotificationManager")&&(n||(n=new f0xy.NotificationManager))},E.addInterest=function(){n&&n.addInterest.apply(n,arguments)},E.addInterests=function(){n&&n.addInterests.apply(n,arguments)},E.removeInterest=function(){n&&n.removeInterest.apply(n,arguments)},E.removeInterests=function(){n&&n.removeInterests.apply(n,arguments)},E.removeAllInterests=function(){n&&n.removeAllInterests.apply(n,arguments)},E.notify=function(){n&&n.notify.apply(n,arguments)},E.holdNotification=function(){n&&n.holdNotification.apply(n,arguments)},E.releaseNotification=function(){n&&n.releaseNotification.apply(n,arguments)},E.cancelNotification=function(){n&&n.cancelNotification.apply(n,arguments)},typeof define=="function"&&define.amd&&define([],function(){return E}),E}(this);f0xy.define("f0xy",{__BaseClass__:function(){var a=function(a){var b,c,d;if(!a||typeof a!="object")return a;if(a instanceof Date)return(new Date).setTime(a.getTime());if(a instanceof Array)return a.concat();if(typeof a=="object"){d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}return a},b=/xyz/.test(function(){xyz})?/\b__super\b/:/.*/,c=function(){};return c.__isDefined=!0,c.__extend=function(d){var e=new this("__no_init__"),f={},g=this;for(var h in d)h!="__static"&&(typeof d[h]=="function"&&typeof g.prototype[h]=="function"&&b.test(d[h])?e[h]=function(a,b){return function(){var c=this.__super;this.__super=g.prototype[a];var d=b.apply(this,arguments);return this.__super=c,d}}(h,d[h]):e[h]=d[h]),typeof d[h]=="object"&&h.indexOf("__")!==0&&(f[h]=d[h]);var i=function(){if(arguments[0]!=="__no_init__"){i.prototype.hasOwnProperty("__imports")||(i.prototype.__imports=f0xy.use(this.__dependencies,{}));if(!this.__isSingleton){for(var b in f)this[b]=a(f[b]);return this.init.apply(this,arguments)}return this.__preInit.apply(this,arguments)}};i.prototype=e,i.prototype.constructor=i,i.__extend=c.__extend,i.__isDefined=!0,d.__isSingleton&&(i.__isSingleton=d.__isSingleton),d.__ns&&(i.__ns=d.__ns),d.__nsID&&(i.__nsID=d.__nsID),d._class&&(i._class=d._class),d.__dependencies&&(i.__dependencies=d.__dependencies);if(d.__static){i.__static=i.__static||{};for(var j in d.__static)i[j]||(i[j]=d.__static[j],i.__static[j]=d.__static[j]);i.__static=d.__static}if(this.__static){i.__static=i.__static||{};for(var j in this.__static)i[j]||(i[j]=this.__static[j],i.__static[j]=this.__static[j])}return i},c}()}),f0xy.define("f0xy",{Class:f0xy.extend("f0xy.__BaseClass__",{__isDefined:!0,init:function(){this._interestHandlers||(this._interestHandlers=[])},use_dependencies:function(){this.dependencies&&f0xy.use(this.dependencies)},unuse_dependencies:function(){f0xy.unuse()},setTimeout:function(a,b){return setTimeout(this.proxy(a),b)},setInterval:function(a,b){return setInterval(this.proxy(a),b)},proxy:function(a){var b=function(a){if(!a)return this;var b=this;return function(){return b.apply(a,Array.prototype.slice.call(arguments))}};return b.call(a,this)},addInterest:function(a,b,c){this._interestHandlers||(this._interestHandlers=[]),b&&(f0xy.addInterest(this,a,c),this._interestHandlers[a]=b)},removeInterest:function(a){this._interestHandlers&&this._interestHandlers[a]&&(this._interestHandlers[a]=null,delete this._interestHandlers[a]),f0xy.removeInterest(this,a)},removeInterests:function(a){for(var b=0;b<a.length;b++)this.removeInterest(a[b])},removeAllInterests:function(){f0xy.removeAllInterests(this),this._interestHandlers=[]},notify:function(a,b){var c=new f0xy.Notification(a,b);c.dispatch(this)},handleNotification:function(a){var b=this._interestHandlers[a.name];b&&this.proxy(b)(a)}})}),f0xy.define("f0xy",{require:["f0xy.Class"],Static:function(){var a=function(){};return a.__isDefined=!0,a.__isStatic=!0,a.__extend=function(a){var b=function(){};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);for(var c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);for(var c in f0xy.Class.prototype)f0xy.Class.prototype.hasOwnProperty(c)&&(b[c]=f0xy.Class.prototype[c]);return b},a}()}),f0xy.define("f0xy",{Singleton:f0xy.extend("f0xy.Class",{__isSingleton:!0,__preInit:function(){return this.constructor.__instance?this.constructor.__instance:(this.init.apply(this,arguments),this.constructor.__instance=this,this.constructor.__instance)},init:function(){},__static:{getInstance:function(){return this.__instance?this.__instance:(this.__instance=new this,this.__instance)}}})}),f0xy.define("f0xy",{NotificationManager:f0xy.extend("f0xy.Class",{_pendingNotifications:[],_interests:{},_removeQueue:[],init:function(){},addInterest:function(a,b,c){c=c||c===0?c:-1,typeof this._interests[b]=="undefined"&&(this._interests[b]=[]),c>-1&&c<this._interests[b].length?this._interests[b].splice(c,0,a):this._interests[b].push(a)},addInterests:function(a,b){for(var c=0;c<b.length;c++)if(typeof b[c]=="string")this.addInterest(a,b[c]);else if(typeof b[c]=="object"||typeof b[c]=="array"){var d=b[c]["priority"]!=null&&b[c]["priority"]!=undefined?b[c].priority:-1;this.addInterest(a,b[c].name,d)}},removeInterest:function(a,b){var c=this._interests[b].indexOf(a);if(a&&c>-1){var d=this.getNotification(b);if(d){var e=this._removeQueue[b]=this._removeQueue[b]||[];e.push(a)}else this._interests[b].splice(c,1)}},removeInterests:function(a,b){for(var c=0;c<b.length;c++)this.removeInterest(a,b[c])},removeAllInterests:function(a,b){if(a!=null)for(var c in this._interests)this.removeInterest(a,c);else b!=null&&(this._interests[b]=null)},notify:function(a){a.status="pending",a.pointer=0,this._interests[a.name]!=null&&(this._pendingNotifications.push(a),this._notifyObjects(a))},_notifyObjects:function(a){var b=a.name;while(a.pointer<this._interests[b].length)if(a.status==="pending")this._interests[b][a.pointer].handleNotification!=null&&this._interests[b][a.pointer].handleNotification(a),a.pointer++;else break;a.status==="pending"&&this.cancelNotification(a.name)},getNotification:function(a,b){for(var c=0;c<this._pendingNotifications.length;c++)if(this._pendingNotifications[c].name===a)return this._pendingNotifications[c];return b?new f0xy.Notification(a,b):!1},holdNotification:function(a){var b=this.getNotification(a);b&&(b.status="hold")},releaseNotification:function(a){var b=this.getNotification(a);b&&b.status==="hold"&&(b.status="pending",this._notifyObjects(b))},cancelNotification:function(a){var b=this.getNotification(a);if(b){this._pendingNotifications.splice(this._pendingNotifications.indexOf(b),1),b.status="";if(this._removeQueue[a]){for(var c=0;c<this._removeQueue.length;c++)this.removeInterest(this._removeQueue[a][c],a);this._removeQueue[a]=null,delete this._removeQueue[a]}}}})}),f0xy.define("f0xy",{Notification:f0xy.extend("f0xy.Class",{data:{},name:"",dispatcher:null,status:"",pointer:0,init:function(a,b){this.name=a,this.data=b},hold:function(){f0xy.holdNotification(this.name)},release:function(){f0xy.releaseNotification(this.name)},cancel:function(){f0xy.cancelNotification(this.name)},dispatch:function(a){this.dispatcher=a,f0xy.notify(this)}})}),f0xy.enableNotifications();
